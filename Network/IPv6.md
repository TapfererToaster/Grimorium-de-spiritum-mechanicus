#CCNA 
# The need for IPv6
IPv6 is designed as a successor to IPv4, because IPv4 does not have enough addresses. This shortage is because the IPv4 has 4.3 billion possible addresses, but there are a lot more devices than that. The use of private addresses and *Network Address Translation (NAT)* slowed down the depletion, but it also created its own problems. 
With the rise of IoT the need for more addresses became clearer, which IPv6 with its 128-bits and 340 undecillion (10^36) possible addresses could provide.

# IPv4 and IPv6 Coexistence
Both IPv4 and IPv6 are used today and will be for the near future so the IETF created protocols that allows for IPv6 migrations.
- **Dual Stack**
  Dual stack allows devices to run IPv4 and IPv6 protocol stacks simultaneously.
- **Tunneling**
  Tunneling encapsulates IPv6 packets inside an IPv4 packet, so it can be transported over an IPv4 network.
- **Translation**
  IPv6 packets are translated to IPv4 packets, using *Network Address Translation 64 (NAT64)* and allows IPv6-enabled devices to communicate with IPv4-enabled devices. 
# Packets
[Cisco Networking Academy](https://www.netacad.com/launch?id=75cbc2e3-bab4-484c-a925-ad839c127c20&tab=curriculum&view=43f9c41c-73eb-5d8e-afef-3b78facacf9f)
# IPv6 Addresses
## Unicast
- **Global Unicast Address (GUA)** - This is similar to a public IPv4 address. These are globally unique, internet-routable addresses. GUAs can be configured statically or assigned dynamically.
- **Link-local Address (LLA)** - This is required for every IPv6-enabled device. LLAs are used to communicate with other devices on the same local link. With IPv6, the term link refers to a subnet. LLAs are confined to a single link. Their uniqueness must only be confirmed on that link because they are not routable beyond the link. In other words, routers will not forward packets with a link-local source or destination address.

# Global Unicast Address (GUA) Assignment
The GUA can be assigned dynamically using stateless and stateful services.
>[!note]
>Stateless means no server maintains network address information which IPv6 addresses are used which are available


![[GUA Assignment.png]]

>[!note] RA Message Flags
>The decision of how a client will obtain an IPv6 GUA depends on the settings within the RA message:
>- **A flag**: Address Autoconfiguration Flag
>  uses Stateless Address Autoconfiguration (SLAAC)
>	- the client creates its own IPv6 GUA using either *Extended Unique Identifier method (EUI-64)* or generate it randomly
>- **O flag**: Other Configuration Flag 
>  uses a stateless DHCPv6 Server
>- **M flag**: Managed Address Configuration Flag
>  uses a stateful DHCPv6 server
 
## Stateless Address Autoconfiguration (SLAAC)
Not every network has or needs access to a DHCPv6 Server, but every device in an IPv6 network needs a GUA. SLAAC enables hosts to create their own unique IPv6 global unicast address.
SLAAC uses ICMPv6 RA messages to provide addressing and other configuration information that would normally be provided by a DHCP server.
### Enabling SLAAC
To enable a router sending RA messages, a router most join the IPv6 all-routers group using `ipv6 unicast-routing`
```
R1(config)# ipv6 unicast-routing
R1(config)# exit
```

### SLAAC Only Method
- The SLAAC only method is enabled by default when the `ipv6 unicast-routing` command is configured. 
- All enabled Ethernet interfaces with an IPV& GUA configured will start sending RA messages with the A flag set to `1`, the O and M flag is set to `0` 
### Generate Interface ID
- **Randomly generated**
  The 64-bit interface ID is randomly generated by the client operating system. 
- **EUI-64**
  The host creates an interface ID using its 48-bit MAC address, by inserting `0xfffe` in the middle of the address and flipping the seventh bit of the interface ID

>[!note]
>Some OS default to randomly generated interface ID instead of the EUI-64 method, due to privacy concerns, as the MAC address is used.

### Duplicate Address Detection
*Duplicate Address Detection (DAD)* is used to ensure a hosts IPv6 GUA is unique. 
DAD is performed by sending an [[(ICMP) Internet Control Message Protocol|ICMPv6]] *Neighbor Solicitation (NS) message* with a specially constructed multicast address, called *solicited-node multicast address*, which duplicates the last 24 bits of IPv6 address of the host.
If no other device responds with a NA message, then the address is virtually guaranteed to be unique.
If another device responds with a NA message the address is not unique and the OS has to determine a new interface ID. 
>[!note]
>The Internet Engineering Task Force  (IETF) recommends to use DAD on all IPv6 addresses.


# Header
![[IPv6 Header.png]]
- **Version** - This field contains a 4-bit binary value set to 0110 that identifies this as an IP version 6 packet.
- **Traffic Class** - This 8-bit field is equivalent to the IPv4 Differentiated Services (DS) field.
- **Flow Label** - This 20-bit field suggests that all packets with the same flow label receive the same type of handling by routers.
- **Payload Length** - This 16-bit field indicates the length of the data portion or payload of the IPv6 packet. This does not include the length of the IPv6 header, which is a fixed 40-byte header.
- **Next Header** - This 8-bit field is equivalent to the IPv4 Protocol field. It indicates the data payload type that the packet is carrying, enabling the network layer to pass the data to the appropriate upper-layer protocol.
- **Hop Limit** - This 8-bit field replaces the IPv4 TTL field. This value is decremented by a value of 1 by each router that forwards the packet. When the counter reaches 0, the packet is discarded, and an ICMPv6 Time Exceeded message is forwarded to the sending host,. This indicates that the packet did not reach its destination because the hop limit was exceeded. Unlike IPv4, IPv6 does not include an IPv6 Header Checksum, because this function is performed at both the lower and upper layers. This means the checksum does not need to be recalculated by each router when it decrements the Hop Limit field, which also improves network performance.
- **Source IPv6 Address** - This 128-bit field identifies the IPv6 address of the sending host.
- **Destination IPv6 Address** - This 128-bit field identifies the IPv6 address of the receiving host.

