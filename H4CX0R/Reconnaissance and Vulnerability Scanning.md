# Passive Reconnaissance
This method is used for gathering information about the target, called *enumeration*, but the tools will not interact directly with the target. 
Common methods are:
- Domain enumeration
- Packet inspection
- Open-source intelligence (OSINT)
- Recon-ng
- Eavesdropping

## OSINT Tools
- https://osintframework.com/

## SpiderFoot
*SpiderFoot* is an automated OSINT scanner, that is included in Kali and kann scan with:
- Domain name
- IP address
- Subnet addresses
- Autonomous System Numbers (ASN)
- Email addresses
- Phone numbers
- Personal names

It allows you to choose a scan based on the use case, required data and by SpiderFoot module.
Cases:
- All: 
  get every information about the target
- Footprint:
  get the targets network perimeter, associated identities and other information 
- Investigate:
  Footprinting, blacklist lookups and other reports on malicious sites will be returned
- Passive:
  a form of OSINT, used is the target should not suspect that it is being scanned

To start SpiderFoot enter the following command and then enter the ip and port number in a browser:
```
$ spiderFoot -l 127.0.0.1:5001
```

>[!note]
>Remember that `127.0.0.1` is the loopback address and refers to you local machine.

## Recon-ng
This is an OSINT framework, similar to Metasploit or the Social-Engineering Toolkit (SET). It consists of a series of modules that can be run in their own workplaces. It is used for a wide variety of reconnaissance. Some modules are already installed on Kali, while others can be downloaded in the modules marketplace.
- To start Recon-ng enter `recon-ng` in the terminal
- Create a workspace with the command `workspace create name`
- To display the currently installed modules use `modules search` 
- To display modules available on the marketplace use `marketplace search`

## DNS Lookup
When your target is a website it is important to know what IP address it uses, for this reason you perform a DNS lookup.
You can use Linux commands like `nslookup`, `host`, `dig` to der form name resolutions.
```
$ dig h4cker.org
$ dig h4cker.org mx
$ nslookup h4cker.org
```

## Secure Socket Layer (SSL) flaws
During reconnaissance you can inspect SSL certificates of a domain to discover potential cryptographic flaws and weak implementations.
You can use https://crt.sh or Linux commands like `sslscan domain.name` for detailed information and analysis of the SSL certificates of your target.

## Company Security Posture
The following tools allow you to search for data breach dumps:
- **WhatBreach:** _[https://github.com/Ekultek/WhatBreach](https://github.com/Ekultek/WhatBreach)_
- **LeakLooker:** _[https://github.com/woj-ciech/LeakLooker](https://github.com/woj-ciech/LeakLooker)_
- **Buster:** _[https://github.com/sham00n/buster](https://github.com/sham00n/buster)_
- **Scavenger:** _[https://github.com/rndinfosecguy/Scavenger](https://github.com/rndinfosecguy/Scavenger)_
- **PwnDB:** _[https://github.com/davidtavarez/pwndb](https://github.com/davidtavarez/pwndb)_

You could also uses these tools to determin if the company has experienced a data breach:
- haveibeenpwned.com
- f-secure.com
- hacknotice.com
- breachdirectory.com
- keepersecurity.com
## Strategic Search Engine Analysis
Use advanced operators when searching with a browser:
- **Filetype:** Directs Google to search only within the text of a particular type of file (for example, filetype:xls)
- **Inurl:** Directs Google to search only within the specified URL of a document (for example, inurl:search-text)
- **Link:** Directs Google to search within hyperlinks for a specific term (for example, link:www.domain.com)
- **Intitle:** Directs Google to search for a term within the title of a document (for example, intitle: “Index of /etc”)

You can also visit the [Google Hacking Database (GHDB)](https://www.exploit-db.com/google-hacking-database/) and search it's categories:
- Footholds
- Files containing usernames
- Sensitive directories
- Web server detection
- Vulnerable files
- Vulnerable servers
- Error messages
- Files containing juicy info
- Files containing passwords
- Sensitive online shopping info
- Network or vulnerability data
- Pages containing login portals
- Various online devices
- Advisories and vulnerabilities
## Shodan
[Shodan](https://www.shodan.io/) is an organization that scans the internet and stores those scans in a database, which you can use to query for vulnerable targets.
# Active Reconnaissance
With this method the tools you use will send probes to the target in order to elicit a response that is then used to determine the state of the target.
Common methods are:
- Host enumeration
- Network enumeration
- User enumeration
- Group enumeration
- Network share enumeration
- Web page enumeration
- Application enumeration
- Service enumeration
- Packet crafting
## Port Scans
Port scans are an active scan in which the tool send various types of probes to the target IP address and examines the responses to determine if a port is open and what service is listening on it.
A popular tool for that is [[Nmap]].

# Enumeration
## Host Enumeration
One of the first things you should do is enumerating hosts to determine which IP addresses are used in your target network.
You can use tools like [[Nmap#Hosts|Nmap]] or [Masscan](https://www.kali.org/tools/masscan/) 
## User Enumeration
User enumeration is performed once you have gained access to the network and want to take a first step to obtain a set of credentials. 
On Windows networks you can try to manipulate the Server Message Block (SMB) protocol, which uses TCP port 445.
![[User Enumeration.png]]
- *SMB_COM_NEGOTIATE*:
  allows the client to tell the server what protocols, flags and options it would like to use.
  The server responds with which protocols, flags and options it prefers; a response could reveal misconfigurations, f.e. it could allowm essages without signatures.
- *MB_COM_SESSION_SETUP_ANDX*:
  After the negotiation the authentication process takes place and is done by sending usernames, passwords and domain names. If the information is not encrypted it is easy to sniff it.
## Group Enumeration
Group enumeration helps you to determine which roles and groups are used in the target environment.
You can use [[Nmap#Group Enumeration|Nmap]] or  to do so.
## Network Share Enumeration
Network Shares are systems on a network that share files, folder and devices such as printers.
You can use[[Nmap#Network Share Enumeration]] for this.
# Packet Inspection and Eavesdropping
To capture, inspect and analyse packets travelling through the network use tools like [Wireshark](https://www.wireshark.org/download.html), [tshark](https://tshark.dev/) or [tcpdump](https://www.kali.org/tools/tcpdump/). 
# Vulnerability Scans
## Types
## Challenges to Consider
- The best time to run a scan
  Scans generate traffic so it is best to scan your target when there is not much traffic, meaning in the early morning or late evening is the best time.
- What protocols to use
  Consider if your target runs both TCP and UDP or just one of them
- Network Topology
  It is not recommended to scan across a WAN, you should perform the scan as close to the target as possible. If you want to scan a server in a subnet the best location for the scan is adjacent to the server on the subnet.
- Bandwidth Limitations
  Always consider that the scan will not cause network congestion and in case use query throttling on your scan 
- Fragile Systems
  Take into consideration that there could be devices that could crash due to the scan, in this case modify the scan or exempt them from the scan

# Investigating Vulnerabilities 
- https://www.us-cert.gov/
- https://cert.org/
- https://www.nist.gov/cyberframework
- https://www.jpcert.or.jp/english/
- https://cve.mitre.org/
- https://cwe.mitre.org/
- https://www.first.org/cvss/

After finding vulnerabilities you should ask yourself the following questions:
- What is the severity of the vulnerability?
- How many systems does the vulnerability apply to?
- How was the vulnerability detected?
- Was the vulnerability found with an automated scanner or manually?
- What is the value of the device on which the vulnerability was found?
- Is this device critical to your business or infrastructure?
- What is the attack vector, and does it apply to your environment?
- Is there a possible workaround or mitigation available?

You can also use Metasploid to search if there is a module for the vulnerability, if so it should be considered high severity.